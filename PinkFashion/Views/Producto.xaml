<?xml version="1.0" encoding="UTF-8"?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PinkFashion.Views.Producto"
             xmlns:PanCake="clr-namespace:Xamarin.Forms.PancakeView;assembly=Xamarin.Forms.PancakeView"
             xmlns:cards="clr-namespace:PanCardView;assembly=PanCardView"
             xmlns:controls="clr-namespace:PanCardView.Controls;assembly=PanCardView"
             xmlns:res="clr-namespace:PanCardView.Resources;assembly=PanCardView"
             xmlns:proc="clr-namespace:PanCardView.Processors;assembly=PanCardView"
             xmlns:carousel="clr-namespace:CarouselView.FormsPlugin.Abstractions;assembly=CarouselView.FormsPlugin.Abstractions"
             xmlns:local="clr-namespace:PinkFashion.Controls;assembly=PinkFashion"
             xmlns:ffimageloading="clr-namespace:FFImageLoading.Forms;assembly=FFImageLoading.Forms"
             x:Name="ProductoPage"
             BackgroundColor="White">

    <ContentPage.Content>

        <ScrollView
            VerticalScrollBarVisibility="Always"  
            BackgroundColor="White">

            <StackLayout
                Padding="15"
                BackgroundColor="White">

                <!-- Imagen Producto -->
                <Grid
                    Grid.Row="1"
                    HorizontalOptions="FillAndExpand"
                    VerticalOptions="FillAndExpand"
                    RowSpacing="3">

                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <ffimageloading:CachedImage
                        Grid.Row="0"
                        x:Name="img"
                        ErrorPlaceholder="errorloading.png"
                        LoadingPlaceholder="loading.png"
                        DownsampleUseDipUnits="false"
                        VerticalOptions="CenterAndExpand"
                        HorizontalOptions="CenterAndExpand"
                        BackgroundColor="White"
                        Aspect="AspectFit"
                        HeightRequest="250"
                        Source="{Binding Imagen}"/>

                    <!--<Label x:Name="vAgotado" Rotation="-45" Opacity=".8" Grid.Row="0"  Text="Agotado" FontFamily="Arial" IsVisible="{Binding Agotado}"  VerticalOptions="CenterAndExpand" HorizontalOptions="CenterAndExpand" TextColor="#ff509f" FontSize="18" />-->

                    <Label
                                                            Rotation="-45"
                                                            Grid.Row="0"
                                                            x:Name="vAgotado"
                                                            Text="Agotado"
                                                            FontFamily="Arial"
                                                            IsVisible="{Binding Agotado}"
                                                            VerticalOptions="CenterAndExpand"
                                                            HorizontalOptions="CenterAndExpand"
                                                            TextColor="#ff509f"
                                                            FontSize="15" />

                </Grid>
                <!-- End Imagen Producto -->

                <!-- Variantes -->
                <StackLayout
                    x:Name="ListaVariantes"
                    Margin="0,15,0,0"
                    BackgroundColor="White">

                    <Label
                        x:Name="vTituloVer"
                        HorizontalOptions="StartAndExpand"
                        FontSize="12"
                        TextColor="#666"/>

                    <carousel:CarouselViewControl
                        InterPageSpacing="0"
                        ShowIndicators="True"
                        IndicatorsTintColor="#ccc"
                        CurrentPageIndicatorTintColor="#ff509f"
                        ShowArrows="True"
                        ArrowsParentMargin="0"
                        ArrowsTintColor="#ff509f"
                        HorizontalArrowsPosition="Center"
                        ArrowsSize="35"
                        ArrowsBackgroundColor="White"
                        ItemsSource="{Binding ColVariantes}"
                        BackgroundColor="White"
                        HeightRequest="200">

                        <carousel:CarouselViewControl.ItemTemplate>

                            <DataTemplate>

                                <Grid
                                    BackgroundColor="Transparent"
                                    Padding="5,0,5,0">

                                    <local:FlowListView_R
                                        FlowColumnCount="2"
                                        HasUnevenRows="True"
                                        HorizontalOptions="FillAndExpand"
                                        SeparatorVisibility="None"
                                        VerticalScrollBarVisibility="Never"
                                        HorizontalScrollBarVisibility="Never"
                                        BackgroundColor="White"
                                        FlowItemTappedCommand="{Binding Path=BindingContext.SelVarianteCommand,  Source={x:Reference ProductoPage}}"
                                        FlowItemsSource="{Binding variantes}"
                                        IsPullToRefreshEnabled="False">

                                        <local:FlowListView_R.FlowColumnTemplate>

                                            <DataTemplate>

                                                <StackLayout
                                                    HeightRequest="150"
                                                    BackgroundColor="White">

                                                    <Grid
                                                        HorizontalOptions="FillAndExpand"
                                                        VerticalOptions="FillAndExpand"
                                                        RowSpacing="0" >

                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="*"/>
                                                        </Grid.RowDefinitions>

                                                        <ffimageloading:CachedImage
                                                            DownsampleUseDipUnits="false"
                                                            LoadingPlaceholder="loading.png"
                                                            ErrorPlaceholder="errorloading.png"
                                                            VerticalOptions="CenterAndExpand"
                                                            HorizontalOptions="CenterAndExpand"
                                                            BackgroundColor="White"
                                                            Aspect="AspectFit"
                                                            HeightRequest="150"
                                                            WidthRequest="150"
                                                            Source="{Binding Imagen_Variante}"/>

                                                        <Label
                                                            Rotation="-45"
                                                            Grid.Row="0"
                                                            x:Name="vAgotado"
                                                            Text="Agotado"
                                                            FontFamily="Arial"
                                                            IsVisible="{Binding Agotado}"
                                                            VerticalOptions="CenterAndExpand"
                                                            HorizontalOptions="CenterAndExpand"
                                                            TextColor="#ff509f"
                                                            FontSize="15" />

                                                    </Grid>

                                                    <Label
                                                        HorizontalOptions="CenterAndExpand"
                                                        HorizontalTextAlignment="Center"
                                                        Text="{Binding descripcion_variante}"
                                                        Style="{StaticResource SmallLabelCollStyle}"  />

                                                </StackLayout>

                                            </DataTemplate>

                                        </local:FlowListView_R.FlowColumnTemplate>

                                    </local:FlowListView_R>

                                </Grid>

                            </DataTemplate>

                        </carousel:CarouselViewControl.ItemTemplate>

                    </carousel:CarouselViewControl>

                </StackLayout>
                <!-- End Variantes -->

                <Label
                    x:Name="vProducto"
                    TextColor="#ff509f"
                    FontSize="16" />

                <Label
                    x:Name="vVariante"
                    Text="{Binding Variantes_producto}"
                    TextColor="#666"
                    FontSize="14" />

                <Label
                    x:Name="vMarca"
                    TextColor="#666"
                    FontSize="14"/>

                <!-- Sobreprecio -->
                <Grid
                    x:Name="BloqueSobrePrecio"
                    HorizontalOptions="StartAndExpand"
                    VerticalOptions="FillAndExpand"
                    RowSpacing="2">

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Label
                        Grid.Row="0"
                        Grid.Column="0"
                        x:Name="vSobrePrecio"
                        HorizontalOptions="Start"
                        HorizontalTextAlignment="Center"
                        Style="{StaticResource PetitLabelStyle}" FontSize="Small"/>

                    <StackLayout
                        Grid.Row="0"
                        Grid.Column="0"
                        HorizontalOptions="Start"
                        VerticalOptions="Center"
                        Spacing="0">

                        <BoxView
                            HeightRequest="1"
                            x:Name="vBoxViewSobreprecio"
                            WidthRequest="90"
                            Rotation="0"
                            BackgroundColor="#ff509f"
                            HorizontalOptions="StartAndExpand"
                            Margin="0,0,0,0"/>

                    </StackLayout>

                    <Label
                        Grid.Row="1"
                        Grid.Column="0"
                        x:Name="vPrecio"
                        HorizontalOptions="EndAndExpand"
                        HorizontalTextAlignment="End"
                        Style="{StaticResource MediumLabelStyle}" />

                </Grid>
                <!-- End Sobreprecio -->

                <Label
                    Text="Descripción"
                    FontSize="12"
                    TextColor="Black"
                    FontAttributes="Bold" 
                    />

                <Label
                    x:Name="vDescripcion"
                    Style="{StaticResource SmallLabelStyle}" />

                <BoxView
                    HeightRequest="1"
                    HorizontalOptions="FillAndExpand"
                    BackgroundColor="#cccccc"
                    Margin="0,15,0,15" />

                <!-- Botonera -->
                <StackLayout
                    HorizontalOptions="FillAndExpand"
                    Spacing="0">

                    <StackLayout
                        HorizontalOptions="FillAndExpand"
                        VerticalOptions="FillAndExpand"
                        Orientation="Horizontal">

                        <!-- mas, menos -->
                        <StackLayout
                            HorizontalOptions="StartAndExpand"
                            VerticalOptions="FillAndExpand"
                            Orientation="Horizontal">

                            <Frame
                                Padding="0"
                                VerticalOptions="CenterAndExpand"
                                BorderColor="#ff509f"
                                HasShadow="false"
                                CornerRadius="5"
                                HeightRequest="37"
                                WidthRequest="40">

                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer
                                        CommandParameter="{Binding .}"
                                        Command="{Binding Path=BindingContext.MenosCommand,  Source={x:Reference ProductoPage}}"/>
                                </Frame.GestureRecognizers>

                                <Label
                                    Text="-"
                                    FontSize="15"
                                    TextColor="#ff509f"
                                    VerticalOptions="CenterAndExpand"
                                    HorizontalOptions="CenterAndExpand" />
                            </Frame>

                            <Frame
                                Padding="0"
                                VerticalOptions="CenterAndExpand"
                                BorderColor="#ff509f"
                                BackgroundColor="#ff509f"
                                HasShadow="false"
                                CornerRadius="5"
                                HeightRequest="37"
                                WidthRequest="50">

                                <Label
                                    Text="{Binding EntCantidad}"
                                    FontSize="15"
                                    TextColor="#fff"
                                    VerticalOptions="CenterAndExpand"
                                    HorizontalOptions="CenterAndExpand" />

                            </Frame>

                            <Frame
                                Padding="0"
                                VerticalOptions="CenterAndExpand"
                                BorderColor="#ff509f"
                                HasShadow="false"
                                CornerRadius="5"
                                HeightRequest="37"
                                WidthRequest="40">

                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer
                                        CommandParameter="{Binding .}"
                                        Command="{Binding Path=BindingContext.MasCommand,  Source={x:Reference ProductoPage}}"/>
                                </Frame.GestureRecognizers>

                                <Label
                                    Text="+"
                                    FontSize="15"
                                    TextColor="#ff509f"
                                    VerticalOptions="CenterAndExpand"
                                    HorizontalOptions="CenterAndExpand" />
                            </Frame>

                            <Label
                                x:Name="UM"
                                FontSize="15"
                                TextColor="#666"
                                FontAttributes="Bold"
                                HorizontalOptions="EndAndExpand" />

                        </StackLayout>

                        <!-- boton agregar -->
                        <Frame
                            Padding="0"
                            VerticalOptions="CenterAndExpand"
                            HorizontalOptions="EndAndExpand"
                            BorderColor="#ff509f"
                            BackgroundColor="#ff509f"
                            HasShadow="false"
                            CornerRadius="5"
                            HeightRequest="37"
                            WidthRequest="80">

                            <Label
                                x:Name="btnAgregar"
                                VerticalOptions="CenterAndExpand"
                                HorizontalOptions="Center"
                                Text="Agregar"
                                TextColor="#fff"
                                FontSize="16" />

                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer
                                CommandParameter="{Binding .}"
                                           Command="{Binding Path=BindingContext.AgregaCommand,  Source={x:Reference ProductoPage}}">
                                </TapGestureRecognizer>
                            </Frame.GestureRecognizers>
                        </Frame>

                    </StackLayout>

                </StackLayout>
                <!-- End Botonera -->

                <BoxView
                    HeightRequest="1"
                    HorizontalOptions="FillAndExpand"
                    BackgroundColor="#cccccc"
                    Margin="0,15,0,15" />

                <!-- Relacionados -->
                <StackLayout BackgroundColor="White">

                    <Label
                        Text="Productos Relacionados"
                        HorizontalOptions="StartAndExpand"
                        FontSize="12"
                        TextColor="#666"/>

                    <carousel:CarouselViewControl
                        InterPageSpacing="0"
                        ShowIndicators="True"
                        IndicatorsTintColor="#ccc"
                        CurrentPageIndicatorTintColor="#ff509f"
                        ShowArrows="True"
                        ArrowsParentMargin="0"
                        ArrowsTintColor="#ff509f"
                        HorizontalArrowsPosition="Center"
                        ArrowsSize="35"
                        ArrowsBackgroundColor="White"
                        ItemsSource="{Binding ColRelacionados}"
                        BackgroundColor="White"
                        HeightRequest="200">

                        <carousel:CarouselViewControl.ItemTemplate>

                            <DataTemplate>

                                <Grid
                                    BackgroundColor="Transparent"
                                    Padding="5,0,5,0">

                                    <local:FlowListView_R
                                        FlowColumnCount="2"
                                        HasUnevenRows="True"
                                        HorizontalOptions="FillAndExpand"
                                        SeparatorVisibility="None"
                                        VerticalScrollBarVisibility="Never"
                                        HorizontalScrollBarVisibility="Never"
                                        BackgroundColor="White"
                                        FlowItemTappedCommand="{Binding Path=BindingContext.SelRelacionadoCommand,  Source={x:Reference ProductoPage}}"
                                        FlowItemsSource="{Binding productos}"
                                        IsPullToRefreshEnabled="False">

                                        <local:FlowListView_R.FlowColumnTemplate>

                                            <DataTemplate>

                                                <StackLayout
                                                    BackgroundColor="White">

                                                    <StackLayout
                                                        HeightRequest="150">

                                                        <Grid
                                                            HeightRequest="150"
                                                            HorizontalOptions="FillAndExpand"
                                                            VerticalOptions="FillAndExpand"
                                                            RowSpacing="0" >

                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="*"/>
                                                            </Grid.RowDefinitions>

                                                            <ffimageloading:CachedImage
                                                                LoadingPlaceholder="loading.png"
                                                                ErrorPlaceholder="errorloading.png"
                                                                DownsampleUseDipUnits="false"
                                                                VerticalOptions="CenterAndExpand"
                                                                HorizontalOptions="CenterAndExpand"
                                                                BackgroundColor="White"
                                                                Aspect="AspectFit"
                                                                HeightRequest="150"
                                                                Source="{Binding Imagen}"/>

                                                            <Label
                                                                Rotation="-45"
                                                                Grid.Row="0"
                                                                x:Name="vAgotado"
                                                                Text="Agotado"
                                                                FontFamily="Arial"
                                                                IsVisible="{Binding Agotado}"
                                                                VerticalOptions="CenterAndExpand"
                                                                HorizontalOptions="CenterAndExpand"
                                                                TextColor="#ff509f"
                                                                FontSize="15" />

                                                        </Grid>

                                                    </StackLayout>

                                                    <StackLayout
                                                        HorizontalOptions="FillAndExpand">

                                                        <StackLayout HeightRequest="20">
                                                        <Label
                                                            Text="{Binding producto}"
                                                            HorizontalOptions="CenterAndExpand"
                                                            HorizontalTextAlignment="Center"
                                                            TextColor="Black"
                                                            FontAttributes="Bold"
                                                            FontSize="13"
                                                            Margin="0, 0, 0, 15"/>

                                                        </StackLayout>
                                                        <Label
                                                            Text="{Binding marca}"
                                                            HorizontalOptions="CenterAndExpand"
                                                            HorizontalTextAlignment="Center"
                                                            TextColor="#666"
                                                            FontAttributes="Bold"
                                                            FontSize="12"
                                                            Margin="0, 5, 15, 0"/>

                                                        <StackLayout
                                                            HorizontalOptions="FillAndExpand"
                                                            Orientation="Horizontal"
                                                            Spacing="0">

                                                            <Grid
                                                                HorizontalOptions="FillAndExpand"
                                                                VerticalOptions="FillAndExpand"
                                                                RowSpacing="3"
                                                                IsVisible="{Binding ConPromo}" >

                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                </Grid.RowDefinitions>

                                                                <Label
                                                                    Grid.Row="0"
                                                                    Text="{Binding SobrePreciostring}"
                                                                    HorizontalOptions="CenterAndExpand"
                                                                    HorizontalTextAlignment="Center"
                                                                    Style="{StaticResource PetitLabelStyle}"/>

                                                                <StackLayout
                                                                    Grid.Row="0"
                                                                    HorizontalOptions="FillAndExpand"
                                                                    VerticalOptions="Center"
                                                                    Spacing="0">

                                                                    <BoxView
                                                                        Grid.Row="0"
                                                                        HeightRequest="2"
                                                                        Rotation="0"
                                                                        BackgroundColor="#ff509f"
                                                                        HorizontalOptions="CenterAndExpand"
                                                                        Margin="0,0,0,0"/>

                                                                </StackLayout>

                                                            </Grid>

                                                            <Label
                                                                Text="{Binding precioCarrito}"
                                                                HorizontalOptions="CenterAndExpand"
                                                                HorizontalTextAlignment="Center"
                                                                FontAttributes="Bold"
                                                                FontSize="12" />

                                                        </StackLayout>

                                                    </StackLayout>

                                                </StackLayout>

                                            </DataTemplate>

                                        </local:FlowListView_R.FlowColumnTemplate>

                                    </local:FlowListView_R>

                                </Grid>

                            </DataTemplate>

                        </carousel:CarouselViewControl.ItemTemplate>

                    </carousel:CarouselViewControl>

                </StackLayout>
                <!-- End Relacionados -->

            </StackLayout>

        </ScrollView>

    </ContentPage.Content>

</ContentPage>
